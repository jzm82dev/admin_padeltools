"use strict";(self.webpackChunkpreclinic_angular=self.webpackChunkpreclinic_angular||[]).push([[8914],{8914:(F,v,o)=>{o.r(v),o.d(v,{PaymentsModule:()=>w});var u=o(6895),m=o(27),h=o(5861),e=o(4650),y=o(1481),b=o(5862),_=o(5226),l=o.n(_),Z=o(6321),d=o(4006);const C=["paypal"],A=["cardInfo"],T=["form_payment"],x=["basic_plan"],U=["premium_plan"],E=["row_plans"];function P(a,s){if(1&a){const c=e.EpF();e.TgZ(0,"div",3)(1,"div",39)(2,"div",24)(3,"div",40)(4,"h5",41),e._uU(5,"Mi suscripci\xf3n"),e.qZA()(),e.TgZ(6,"div",42)(7,"form")(8,"div",43)(9,"div",44)(10,"label"),e._uU(11,"Suscripci\xf3n id"),e.qZA(),e._UZ(12,"input",45),e.qZA(),e.TgZ(13,"div",44)(14,"label"),e._uU(15,"Plan actual"),e.qZA(),e._UZ(16,"input",46),e.qZA(),e.TgZ(17,"div",44)(18,"label"),e._uU(19,"Fecha de inicio"),e.qZA(),e._UZ(20,"input",45),e.ALo(21,"date"),e.qZA(),e.TgZ(22,"div",44)(23,"label"),e._uU(24,"Membres\xeda vigente hasta"),e.qZA(),e._UZ(25,"input",45),e.ALo(26,"date"),e.qZA(),e.TgZ(27,"div",29)(28,"div",47),e._UZ(29,"span",31),e.qZA()(),e.TgZ(30,"div",48)(31,"div",49)(32,"button",50),e.NdJ("click",function(){e.CHM(c);const i=e.oxw();return e.KtG(i.cancelSubscription())}),e._uU(33,"CANCELAR SUSCRIPCI\xd3N"),e.qZA()()()()()()()()()}if(2&a){const c=e.oxw();e.xp6(12),e.s9C("value",c.current_subscription.subscription_id),e.xp6(4),e.s9C("value",c.current_subscription.slug),e.xp6(4),e.s9C("value",e.xi3(21,4,c.current_subscription.created_at,"dd/MM/yyyy , HH:mm")),e.xp6(5),e.s9C("value",e.xi3(26,7,c.current_subscription.active_until,"dd/MM/yyyy"))}}function L(a,s){if(1&a&&(e.TgZ(0,"div",51),e._uU(1),e.qZA()),2&a){const c=e.oxw();e.xp6(1),e.hij(" ",c.cardError," ")}}const S=[{path:"",component:(()=>{const s=class{constructor(t,i){this.ngZone=t,this.paymentService=i,this.sanitazer=(0,e.f3M)(y.H7),this.paymentHandler=null,this.stripeAPIKey=b.Hs,this.success_message="",this.error_message="",this.plans=[],this.loaded=!1,this.current_subscription=null,this.has_active_subscription=!1}ngOnInit(){this.basic_plan_selected=document.getElementById("basic_plan"),this.premium_plan_selected=document.getElementById("premium_plan"),this.hideLoading(),this.paymentService.getActivePlans().subscribe(t=>{200==t.message&&(this.loaded=!0,this.plans=t.plans,this.plan_selected=this.plans[1])}),this.paymentService.getCurrentSubscription().subscribe(t=>{200==t.message&&(this.loaded=!0,this.current_subscription=t.current_subscription,this.has_active_subscription=t.has_active_subscription,0==this.has_active_subscription?(this.row_plans.nativeElement.classList.remove("hide-payment-form"),this.formPayment.nativeElement.classList.remove("hide-payment-form"),this.paypalInitialise(this.plan_selected.paypal_id),this.stripelInitialise()):(this.row_plans.nativeElement.classList.remove("hide-payment-form"),"premium"==this.current_subscription.slug?this.basic_plan.nativeElement.classList.add("hide-payment-form"):this.premium_plan.nativeElement.classList.add("hide-payment-form")))})}stripelInitialise(){null==this.current_subscription&&(this.card=elements.create("card",{hidePostalCode:!0,style:{base:{color:"#32325d",fontFamily:'"Helvetica Neue", Helvetica, sans-serif',fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#aab7c4"}},invalid:{color:"#fa755a",iconColor:"#fa755a"}}}),this.cardInfo&&(this.card.mount(this.cardInfo.nativeElement),this.card.addEventListener("change",this.onChange.bind(this))))}onChange(t){this.ngZone.run(null!=t.error?()=>this.cardError=t.error.message:()=>this.cardError=null)}paymentIntent(){var t=this;return(0,h.Z)(function*(){const{token:i,error:r}=yield stripe.createToken(t.card);i?t.paymentService.chargePaymentIntent(100,i.id).subscribe(n=>{stripe.confirmCardPayment(n.client_secret).then(function(p){p.error?alert("error"):alert("bieeen")})}):t.ngZone.run(()=>t.cardError=r.message)})()}createSubscription(){var t=this;return(0,h.Z)(function*(){const{token:i,error:r}=yield stripe.createToken(t.card);i?(t.showLoading(),t.paymentService.createSubscription(t.plan_selected.slug,i.id).subscribe(n=>{t.hideLoading(),stripe.confirmCardPayment(n.subscription.latest_invoice.payment_intent.client_secret).then(function(g){g.error?l().fire({title:"Oppss... ",text:"Something went wrong!",icon:"error"}):l().fire({title:"Goood",text:"Se ha activado tu suscripci\xf3n",icon:"success",confirmButtonColor:"#3085d6",confirmButtonText:"Cerrar!"}).then(f=>{f.isConfirmed&&document.location.reload()})})})):t.ngZone.run(()=>t.cardError=r.message)})()}hideLoading(){var t=document.getElementById("loading");t&&(t.classList.remove("show-spinner"),t.classList.add("hide-spinner"))}ngOnDestroy(){this.card&&this.card.destroy()}showLoading(){var t=document.getElementById("loading");t&&(t.classList.remove("hide-spinner"),t.classList.add("show-spinner"))}paypalInitialise(t){var r,i=this;paypal.Buttons({style:{color:"gold",shape:"rect",layout:"vertical"},createSubscription:(r,n)=>n.subscription.create({plan_id:t}),onApprove:(r=(0,h.Z)(function*(n,p){i.paymentService.saveSubscription(n.subscriptionID,t).subscribe(g=>{l().fire({title:"Goood",text:"Se ha activado tu suscripci\xf3n",icon:"success",confirmButtonColor:"#3085d6",confirmButtonText:"Cerrar!"}).then(f=>{f.isConfirmed&&document.location.reload()})})}),function(p,g){return r.apply(this,arguments)}),onError:r=>{l().fire({title:"Oppss... ",text:"Something went wrong!",icon:"error"}),console.error("An error prevented the buyer from checking out with PayPal")}}).render(this.paypalElement?.nativeElement)}selectPlan(t){const i=document.getElementById("paypal-button");i&&(i.innerHTML="");const r=this.plans.findIndex(n=>n.slug==t);this.plan_selected=this.plans[r],this.paypalInitialise(this.plan_selected.paypal_id),"basic"==t?(this.basic_plan_selected.classList.add("plan-selected"),this.premium_plan_selected.classList.remove("plan-selected")):(this.basic_plan_selected.classList.remove("plan-selected"),this.premium_plan_selected.classList.add("plan-selected"))}cancelSubscription(){var t;this.showLoadingCancel(),t=this.current_subscription.subscription_id.startsWith("I-")?"1":"2",this.paymentService.cancelSubscription(this.current_subscription.subscription_id,t).subscribe(i=>{this.hideLoadingCancel(),l().fire({title:"Goood",text:"Subscription cancelada.",icon:"success",confirmButtonColor:"#3085d6",confirmButtonText:"Cerrar!"}).then(r=>{r.isConfirmed&&(window.location.href="/payments/get-subscription")})})}hideLoadingCancel(){var t=document.getElementById("loading-cancel");t&&(t.classList.remove("show-spinner"),t.classList.add("hide-spinner"))}showLoadingCancel(){var t=document.getElementById("loading-cancel");t&&(t.classList.remove("hide-spinner"),t.classList.add("show-spinner"))}};let a=s;return s.\u0275fac=function(i){return new(i||s)(e.Y36(e.R0b),e.Y36(Z.t))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-payments"]],viewQuery:function(i,r){if(1&i&&(e.Gf(C,7),e.Gf(A,7),e.Gf(T,5),e.Gf(x,5),e.Gf(U,5),e.Gf(E,5)),2&i){let n;e.iGM(n=e.CRH())&&(r.paypalElement=n.first),e.iGM(n=e.CRH())&&(r.cardInfo=n.first),e.iGM(n=e.CRH())&&(r.formPayment=n.first),e.iGM(n=e.CRH())&&(r.basic_plan=n.first),e.iGM(n=e.CRH())&&(r.premium_plan=n.first),e.iGM(n=e.CRH())&&(r.row_plans=n.first)}},decls:105,vars:2,consts:[[1,"page-wrapper"],[1,"content"],[1,"page-header"],[1,"row"],[1,"col-sm-12"],[1,"breadcrumb"],[1,"breadcrumb-item","active"],["class","row",4,"ngIf"],[1,"row","hide-payment-form"],["row_plans",""],[1,"col-sm-6","col-md-6","col-xl-6",3,"click"],["basic_plan",""],["id","basic_plan",1,"blog","grid-blog","plan-basic","cursor-on"],[1,"text-center"],["type","button",1,"btn","btn-primary","btn-lg","me-1"],[1,"text-start","my-4"],[1,"remove-doc"],[1,"blog-content"],[1,"blog-title"],["premium_plan",""],["id","premium_plan",1,"blog","grid-blog","plan-premium","plan-selected","cursor-on"],["id","form-payment",1,"row","hide-payment-form"],["form_payment",""],[1,"col-sm-4","col-md-4","col-xl-4"],[1,"card"],[1,"card-body","pt-0","my-4"],[1,"credit-card","text-center","my-3"],["cardInfo",""],["class","error my-2",4,"ngIf"],[1,"d-flex","justify-content-center"],["role","status","id","loading",1,"spinner-border"],[1,"sr-only"],[1,"text-center","mt-2"],["id","payButton",1,"btn","btn-primary","btn-lg","me-1",3,"click"],[1,"text-center","my-4"],[1,"card-body","pt-0","my-4","text-center"],[1,"row","text-center"],["id","paypal-button"],["paypal",""],[1,"col-md-6"],[1,"card-header"],[1,"card-title"],[1,"card-body","pt-0"],[1,"settings-form"],[1,"form-group","form-placeholder"],["type","text","disabled","",1,"form-control",3,"value"],["type","text","disabled","",1,"form-control","capitalize",3,"value"],["role","status","id","loading-cancel",1,"spinner-border","hide-spinner"],[1,"form-group","mb-0","text-center","my-4"],[1,"settings-btns"],["type","button",1,"btn","btn-danger","btn-lg","me-1",3,"click"],[1,"error","my-2"]],template:function(i,r){1&i&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"ul",5)(6,"li",6),e._uU(7,"Current susbcription"),e.qZA()()()()(),e.YNc(8,P,34,10,"div",7),e.TgZ(9,"div",8,9)(11,"div",10,11),e.NdJ("click",function(){return r.selectPlan("basic")}),e.TgZ(13,"div",12)(14,"div",13)(15,"button",14),e._uU(16,"PLAN B\xc1SICO"),e.qZA()(),e.TgZ(17,"div",15)(18,"h3"),e._uU(19,"El plan incluye: "),e.qZA()(),e.TgZ(20,"div",15)(21,"ul")(22,"li"),e._uU(23," Visible en la parte p\xfablica "),e.qZA(),e.TgZ(24,"li"),e._uU(25," Gesti\xf3n reservas de pistas "),e.qZA(),e.TgZ(26,"li"),e._uU(27," Alta y baja de monitores "),e.qZA(),e.TgZ(28,"li"),e._uU(29," Gesti\xf3n de socios "),e.qZA(),e.TgZ(30,"li",16),e._uU(31," \xa0 "),e.qZA(),e.TgZ(32,"li",16),e._uU(33," \xa0 "),e.qZA()()(),e.TgZ(34,"div",13)(35,"h2"),e._uU(36,"29.90\u20ac"),e.qZA(),e.TgZ(37,"p"),e._uU(38,"/MES"),e.qZA()(),e.TgZ(39,"div",17)(40,"h3",18),e._uU(41,"Este plan no tiene permanencia y podr\xe1s darte de baja cuando quieras con s\xf3lo hacer un click."),e.qZA(),e.TgZ(42,"p"),e._uU(43,"El importe de 29.90\u20ac se cobrar\xe1 todos los meses mientras la suscripci\xf3n est\xe9 activa"),e.qZA()()()(),e.TgZ(44,"div",10,19),e.NdJ("click",function(){return r.selectPlan("premium")}),e.TgZ(46,"div",20)(47,"div",13)(48,"button",14),e._uU(49,"PLAN PREMIUM"),e.qZA()(),e.TgZ(50,"div",15)(51,"h3"),e._uU(52,"El plan incluye: "),e.qZA()(),e.TgZ(53,"div",15)(54,"ul")(55,"li"),e._uU(56," Visible en la parte p\xfablica "),e.qZA(),e.TgZ(57,"li"),e._uU(58," Gesti\xf3n reservas de pistas "),e.qZA(),e.TgZ(59,"li"),e._uU(60," Alta y baja de monitores "),e.qZA(),e.TgZ(61,"li"),e._uU(62," Gesti\xf3n de socios "),e.qZA(),e.TgZ(63,"li"),e._uU(64," Creaci\xf3n y gesti\xf3n ilimitadas de ligas "),e.qZA(),e.TgZ(65,"li"),e._uU(66," Creaci\xf3n y gesti\xf3n ilimitadas de torneos "),e.qZA()()(),e.TgZ(67,"div",13)(68,"h2"),e._uU(69,"54.90\u20ac"),e.qZA(),e.TgZ(70,"p"),e._uU(71,"/MES"),e.qZA()(),e.TgZ(72,"div",17)(73,"h3",18),e._uU(74,"Este plan no tiene permanencia y podr\xe1s darte de baja cuando quieras con s\xf3lo hacer un click."),e.qZA(),e.TgZ(75,"p"),e._uU(76,"El importe de 54.90\u20ac se cobrar\xe1 todos los meses mientras la suscripci\xf3n est\xe9 activa"),e.qZA()()()()(),e.TgZ(77,"div",21,22),e._UZ(79,"div",23),e.TgZ(80,"div",23)(81,"div",24)(82,"div",25)(83,"div",13)(84,"b"),e._uU(85," Datos de la tarjeta "),e.qZA()(),e.TgZ(86,"div",26),e._UZ(87,"div",null,27),e.YNc(89,L,2,1,"div",28),e.qZA(),e.TgZ(90,"div",29)(91,"div",30),e._UZ(92,"span",31),e.qZA()(),e.TgZ(93,"div",32)(94,"button",33),e.NdJ("click",function(){return r.createSubscription()}),e._uU(95,"Paga Seguro con Tarjeta"),e.qZA()(),e.TgZ(96,"div",34)(97,"b"),e._uU(98,"o puedes suscribirte a trav\xe9s de"),e.qZA()(),e._UZ(99,"div",34),e.TgZ(100,"div",35)(101,"div",36)(102,"div",13),e._UZ(103,"div",37,38),e.qZA()()()()()()()()()),2&i&&(e.xp6(8),e.Q6J("ngIf",r.current_subscription),e.xp6(81),e.Q6J("ngIf",r.cardError))},dependencies:[u.O5,d._Y,d.JL,d.F,u.uU],styles:[".credit-card[_ngcontent-%COMP%]{height:50px;background-color:#e0f0f3;padding:20px;display:flex;flex-direction:column;justify-content:space-evenly}.error[_ngcontent-%COMP%]{color:red;font-size:15px}.hide-spinner[_ngcontent-%COMP%]{display:none!important}.hide-payment-form[_ngcontent-%COMP%]{display:none}.show-payment-form[_ngcontent-%COMP%]{display:inline}.show-spinner[_ngcontent-%COMP%]{display:inline!important}#loading[_ngcontent-%COMP%], #loading-cancel[_ngcontent-%COMP%]{position:absolute;left:50%;top:50%;z-index:1;width:150px;height:150px;margin:-75px 0 0 -75px;border:16px solid #f3f3f3;border-radius:50%;border-top:16px solid #3498db;width:120px;height:120px;animation:_ngcontent-%COMP%_spin 2s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.plan-basic[_ngcontent-%COMP%]{background-color:#cff4fc}.plan-premium[_ngcontent-%COMP%]{background-color:#a3cfbb}.remove-doc[_ngcontent-%COMP%]{list-style-type:none}.plan-selected[_ngcontent-%COMP%]{border:solid 2px blue}.cursor-on[_ngcontent-%COMP%]{cursor:pointer}.capitalize[_ngcontent-%COMP%]{text-transform:capitalize}"]}),a})()}];let I=(()=>{const s=class{};let a=s;return s.\u0275fac=function(i){return new(i||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[m.Bz.forChild(S),m.Bz]}),a})();var q=o(529),M=o(5108);let w=(()=>{const s=class{};let a=s;return s.\u0275fac=function(i){return new(i||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[u.ez,I,d.u5,d.UX,q.JF,m.Bz,M.m]}),a})()}}]);